(()=>{"use strict";var e,t={630:(e,t,n)=>{const s=jQuery;var i=n.n(s),a=n(15);function o(e,t,n=0){const s=t[0]-n,i=t[1]+n;return s<=e&&e<=i}function r(e,t){return(t?[e/3600,e/60%60,e%60]:[e/60,e%60]).map(((e,t)=>Math.floor(e).toString().padStart(0==t?0:2,"0"))).join(":")}function c(e){const t=document.createElement("template");return t.innerHTML=e,t.content.firstElementChild}class d{constructor(){this._idCnt=0,this._testCanvas=null,this._lang={locale:"en",phrasesInput:{},phrasesCompiled:{}}}mkid(){return"__autoid_"+ ++this._idCnt}supportsCanvasExport(e){return this._getTestCanvas().toDataURL(e).match(/data:(.*);/)[1]===e}setLang(e){this._lang={locale:e.locale,phrasesInput:e.phrases,phrasesCompiled:{}}}t(e,t={}){if(!(e in this._lang.phrasesCompiled)){if(!(e in this._lang.phrasesInput))return console.error(`Warning: Translation key '${e}' not defined.`),e;this._lang.phrasesCompiled[e]=new a.ZP(this._lang.phrasesInput[e],this._lang.locale)}return this._lang.phrasesCompiled[e].format(t)}_getTestCanvas(){return this._testCanvas||(this._testCanvas=document.createElement("canvas")),this._testCanvas}}class l extends class{constructor(e={}){this._state=e,this._pendingStateUpdates=[],this._renderTimeout=null,this._renderPromise=Promise.resolve(),this._eventCallbacks={updated:[]}}on(e,t){this._eventCallbacks[e].push(t)}update(){return this._renderPromise}setState(e={}){this._pendingStateUpdates.push(e),this._renderTimeout||(this._renderPromise=new Promise((e=>{this._renderTimeout=setTimeout((()=>{const t=this._pendingStateUpdates.reduce(Object.assign,{}),n=Object.assign({},this._state,t);this.render(n),this._state=n,this._pendingStateUpdates=[],this._renderTimeout=null,this._renderPromise=Promise.resolve();for(const e of this._eventCallbacks.updated)e(n);e()}))})))}render(e){}}{constructor(e,t={}){super({show:!1,...t}),this._parent=e,this._isAnimating=!1,this._dom=this._createDom(),this._dom.close.addEventListener("click",this.close.bind(this)),this._parent.append(this._dom.main),this._$main=i()(this._dom.main)}_createDom(e=""){const t={main:document.createElement("div"),headline:document.createElement("div"),title:document.createElement("h3"),close:document.createElement("span"),body:document.createElement("div")};return t.main.className=`sxnd-modal ${e}`,t.headline.className="headline-container",t.close.className="modal-close icon-close",t.body.className="body-container",t.main.append(t.headline,t.body),t.headline.append(t.title,t.close),t}get isOpen(){return this._state.show}open(e=!0){this._isAnimating||this.setState({show:e})}close(){this.open(!1)}toggle(){this.open(!this._state.show)}render(e){const{show:t}=e;if(t!=this._state.show){this._isAnimating=!0;const e=t?"show":"hide";this._$main[e]({duration:"fast",complete:()=>{this._isAnimating=!1}})}}}class h extends l{constructor(e,t){super(e,{env:t,timecode:null,startAtTimecode:!0})}_createDom(){const e=super._createDom("bookmark-modal");e.title.innerText="Bookmark (Link teilen)";const t=this._state.env.mkid();return e.container=c(`\n      <div>\n        <div class="url-line">\n          <input type="url" readonly value="https://sachsen.digital">\n          <a href="javascript:void(0)" class="copy-to-clipboard" title="Link kopieren">\n            <i class="material-icons-round">content_copy</i>\n          </a>\n        </div>\n        <div class="start-at">\n          <input type="checkbox" id="${t}">\x3c!--\n          --\x3e<label for="${t}">\n            Bei aktueller Zeit (<span class="start-at-timecode-label"></span>) starten.\n          </label>\n        </div>\n      </div>\n    `),e.url=e.container.querySelector("input"),e.copyToClipboard=e.container.querySelector(".copy-to-clipboard"),e.copyToClipboard.addEventListener("click",this.handleCopyToClipboard.bind(this)),e.startAt=e.container.querySelector(".start-at"),e.startAtTimecodeCheck=e.container.querySelector("input[type=checkbox]"),e.startAtTimecodeCheck.addEventListener("change",this.handleChangeStartAtTimecode.bind(this)),e.startAtTimecodeLabel=e.container.querySelector(".start-at-timecode-label"),e.body.append(e.container),e}async handleCopyToClipboard(){const e=this.generateUrl(this._state).toString();this._dom.url.focus(),navigator.clipboard?navigator.clipboard.writeText(e):document.execCommand("copy")}handleChangeStartAtTimecode(e){this.setState({startAtTimecode:e.target.checked})}generateUrl(e){const t=new URL(window.location);return e.startAtTimecode&&null!=e.timecode&&0!==e.timecode?t.searchParams.set("timecode",e.timecode):t.searchParams.delete("timecode"),t}setTimecode(e){return this.setState({timecode:e}),this}render(e){super.render(e);const{show:t,timecode:n,startAtTimecode:s}=e;this._dom.url.value=this.generateUrl(e).toString(),null===n||0===n?this._dom.startAt.classList.remove("shown"):(this._dom.startAtTimecodeCheck.checked=s,this._dom.startAtTimecodeLabel.innerText=r(n),this._dom.startAt.classList.add("shown")),t&&t!==this._state.show&&this._dom.url.select()}}let m=0;class p{constructor(e){this._chapters=e.map((e=>({id:m++,title:e.title,timecode:parseInt(e.timecode,10)}))),this._chapters.sort(((e,t)=>e.timecode-t.timecode)),this._idToIndex=new Map;for(let e=0;e<this._chapters.length;e++){const t=this._chapters[e];this._idToIndex.set(t.id,e)}}at(e){return this._chapters[e]}indexOf(e){return this._idToIndex.get(e.id)}advance(e,t=1){let n=this.indexOf(e);if(void 0!==n)return this._chapters[n+t]}timeToChapter(e){for(let t=this._chapters.length-1;t>=0;t--){const n=this._chapters[t];if(e>=n.timecode)return n}}[Symbol.iterator](){return this._chapters.values()}}var u=n(480),v=n.n(u);class g extends v().ui.Element{constructor(e,t,n={}){super(e,t,n.material_icon),this._config=n,this.button=document.createElement("button"),this.button.className="material-icons-round",this.button.title=n.title,this.button.textContent=n.material_icon,this.parent.appendChild(this.button),this._config.onClick&&this.eventManager.listen(this.button,"click",this._config.onClick)}static register(e,t={}){const n=e.mkid();return v().ui.Controls.registerElement(n,{create:(e,n)=>new g(e,n,t)}),n}}class y extends l{constructor(e,t,n){super(e,{env:t,config:n})}_createDom(){const{env:e,config:{constants:t,keybindings:n}}=this._state,s=super._createDom("help-modal");s.title.innerText=e.t("modal.help.title");const i=function(e){const t={navigate:{},other:{}},n=e.slice();n.sort(((e,t)=>e.order-t.order));for(const e of n)t[e.kind]||(t[e.kind]={}),t[e.kind][e.action]||(t[e.kind][e.action]=[]),t[e.kind][e.action].push(e);return t}(n);for(const[n,a]of Object.entries(i)){const i=[...Object.entries(a)];if(0===i.length)continue;const o=c('<h3 class="subheader"></h3>');o.innerText=e.t(`action.kind.${n}`),s.body.append(o);const r=c('\n        <table class="keybindings-table">\n          <tbody>\n            <tr>\n              <td class="legend key"></td>\n              <td class="legend action"></td>\n            </tr>\n          </tbody>\n        </table>\n      ');r.querySelector(".legend.key").innerText=e.t("modal.help.key"),r.querySelector(".legend.action").innerText=e.t("modal.help.action");const d=c('\n        <tr>\n          <td class="key"></td>\n          <td class="action"></td>\n        </tr>\n      '),l=r.querySelector("tbody");for(const[n,s]of i){const i=d.cloneNode(!0),a=i.querySelector(".key");for(let t=0;t<s.length;t++){const n=s[t];if(t>0){const t=c('<span class="or-sep"></span>');t.innerText=e.t("or"),a.append(t)}const i=n.mod?e.t(`key.mod.${n.mod}`)+" + "+e.t(`key.${n.key}.mod`):e.t(`key.${n.key}`);a.append(document.createTextNode(i))}i.querySelector(".action").innerText=e.t(`action.${n}`,t),l.append(i)}r.append(l),s.body.append(r)}return s}}const k={None:0,CtrlMeta:1,Shift:2,Alt:4};class f extends v().ui.Element{static KEY="time_and_duration_frame";constructor(e,t){super(e,t),this.currentTime_=document.createElement("button"),this.currentTime_.classList.add("shaka-current-time"),this.parent.appendChild(this.currentTime_),this.state={},this.render({totalSeconds:0,activeMode:0}),this.eventManager.listen(this.currentTime_,"click",(()=>{this.render({activeMode:(this.state.activeMode+1)%3})})),this.eventManager.listen(this.controls,"timeandseekrangeupdated",(()=>{this.render({totalSeconds:this.controls.getDisplayTime()})}))}render(e){const t=Object.assign({},this.state,e),{totalSeconds:n,activeMode:s}=t;if(n!==this.state.totalSeconds||s!==this.state.activeMode){const e=this.controls.elSxndPlayer,t=e.video.duration>=3600;let i,a;switch(s){default:i=r(n,t),e.vifa&&(i+=":"+("0"+e.vifa.get()%e.fps).slice(-2)),e.video.duration&&(i+=" / "+r(e.video.duration,t)),a="Aktuelle Laufzeit / Gesamtlaufzeit";break;case 1:i=r(e.video.duration-n,t),a="Restlaufzeit";break;case 2:i=`${e.vifa.get()}`,a="Frame-Nummer"}let o=e.chapters.timeToChapter(n);o&&(i+=` â€“ ${o.title}`),this.currentTime_.textContent=i,this.currentTime_.title=a}this.state=t}}f.Factory=class{create(e,t){return new f(e,t)}},v().ui.Controls.registerElement(f.KEY,new f.Factory);class b{constructor(){this.tasks={}}abortPending(){for(const e of Object.keys(this.tasks))this.tasks[e].loaded||(this.tasks[e].request.abort(),delete this.tasks[e])}get(e){if(!this.tasks[e]){let t;this.abortPending();const n=new Promise(((n,s)=>{t=new XMLHttpRequest,t.responseType="blob",t.onload=s=>{if(this.tasks[e].loaded=!0,i=t.status,2===Math.floor(i/100)){const s=URL.createObjectURL(t.response),i=document.createElement("img");i.onload=()=>{URL.revokeObjectURL(s),this.tasks[e].response=i,n(i)},i.src=s}else t.onerror(s);var i},t.onerror=t=>{delete this.tasks[e],s(t)},t.open("GET",e),t.send()}));this.tasks[e]={request:t,promise:n,loaded:!1}}return this.tasks[e].promise}}class w{constructor(e){this.mainContainer=e.mainContainer,this.seekBar=e.seekBar,this.seekThumbSize=e.seekThumbSize,this.player=e.player,this.network=e.network;const t=c('\n      <div class="thumbnail-preview">\n        <div class="display">\n          <canvas>\n        </div>\n        <span class="timecode"></span>\n      </div>\n    ');this.dom={container:t,display:t.querySelector(".display"),canvas:t.querySelector("canvas"),timecode:t.querySelector(".timecode")},this.ctx=this.dom.canvas.getContext("2d"),this.lastRendered=null,this.seekBar.append(this.dom.container),this.handlers={onWindowBlur:this.onWindowBlur.bind(this),onMouseMove:this.onMouseMove.bind(this)},window.addEventListener("blur",this.handlers.onWindowBlur),this.mainContainer.addEventListener("mousemove",this.handlers.onMouseMove)}onWindowBlur(){this.hidePreview(!1)}getVideoDuration(){return this.player.getMediaElement().duration}getThumbsTrack(){const e=this.player.getStats().estimatedBandwidth,t=this.player.getImageTracks().filter((t=>t.bandwidth<.01*e));return t.sort(((e,t)=>t.bandwidth-e.bandwidth)),t[0]}mouseEventToPosition(e){if(null!==document.querySelector("input[type=button]:hover, button:hover"))return;const t=this.seekBar.getBoundingClientRect();if(n=t,!o((s={x:e.clientX,y:e.clientY,toleranceY:6}).x,[n.left,n.right],s.toleranceX)||!o(s.y,[n.top,n.bottom],s.toleranceY))return;var n,s;const i=e.clientX-t.left,a=(i-this.seekThumbSize/2)/(t.width-this.seekThumbSize);return{absolute:i,relative:a,seconds:a*this.getVideoDuration()}}async onMouseMove(e){const t=this.getThumbsTrack();if(void 0===t)return this.hidePreview();const n=this.mouseEventToPosition(e);if(void 0===n)return this.hidePreview();const s=await this.player.getThumbnails(t.id,n.seconds);if(null===s||0===s.uris.length)return this.hidePreview();const i=s.uris[0];null===this.lastRendered||i!==this.lastRendered.uri?this.network.get(i).then((e=>{this.renderImage(i,s,e),this.setIsVisible(!0)})).catch((()=>{this.hidePreview()})):(this.renderImage(i,s,this.lastRendered.tilesetImage),this.setIsVisible(!0)),this.renderSeekPosition(n)}hidePreview(){this.setIsVisible(!1)}renderImage(e,t,n){null!==this.lastRendered&&t.startTime===this.lastRendered.thumb.startTime||(this.ctx.drawImage(n,t.positionX,t.positionY,t.width,t.height,0,0,this.dom.canvas.width,this.dom.canvas.height),this.lastRendered={uri:e,thumb:t,tilesetImage:n})}renderSeekPosition(e){const t=(n=e.absolute-this.dom.container.offsetWidth/2)<(s=[0,this.seekBar.clientWidth-this.dom.container.offsetWidth])[0]?s[0]:n>s[1]?s[1]:n;var n,s;this.dom.container.style.left=`${t}px`,this.dom.timecode.innerText=r(e.seconds,this.getVideoDuration()>=3600)}setIsVisible(e){e?this.dom.container.classList.add("shown"):this.dom.container.classList.remove("shown")}}class _{constructor(e){this.env=e.env,this.container=e.container,this.video=e.video,this.manifestUri=e.manifestUri,this.initialTimecode=e.timecode,this.chapters=e.chapters,this.controlPanelButtons=e.controlPanelButtons??[],this.overflowMenuButtons=e.overflowMenuButtons??[],this.constants=Object.assign({prevChapterTolerance:5},e.constants)}async initialize(){this.fps=25,this.player=new(v().Player)(this.video);const e=new(v().ui.Overlay)(this.player,this.container,this.video);this.controls=e.getControls(),this.controls.elSxndPlayer=this;const t={addSeekBar:!0,controlPanelElements:["play_pause","chapters_menu",f.KEY,"spacer","volume","mute",...this.controlPanelButtons,"fullscreen","overflow_menu"],overflowMenuButtons:["language","playback_rate","loop","quality","picture_in_picture","captions",...this.overflowMenuButtons],addBigPlayButton:!0,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"}};e.configure(t),this.player.addEventListener("error",this.onPlayerErrorEvent.bind(this)),this.controls.addEventListener("error",this.onUiErrorEvent.bind(this)),this.vifa=VideoFrame({id:this.video.id,frameRate:this.fps,callback:function(e){console.log("callback response: "+e)}});try{console.log("The video has now been loaded!"),await this.player.load(this.manifestUri,this.initialTimecode)}catch(e){onError(e)}this.seekBar=this.container.querySelector(".shaka-seek-bar-container"),this.thumbnailPreview=new w({mainContainer:this.container,seekBar:this.seekBar,seekThumbSize:12,player:this.player,network:new b}),this.renderChapterMarkers()}setLocale(e){this.controls.getLocalization().changeLocale([e])}renderChapterMarkers(){for(const e of this.chapters){const t=e.timecode/this.video.duration;if(!(0<=t&&t<1))continue;const n=document.createElement("span");n.className="sxnd-chapter-marker",n.style.position="absolute",n.style.left=e.timecode/this.video.duration*100+"%",n.title=e.title,n.addEventListener("click",(()=>{this.play(),this.seekTo(e)}));const s=document.createElement("span");n.append(s),this.seekBar.append(n)}}onPlayerErrorEvent(e){this.onPlayerError(e.detail)}onUiErrorEvent(e){this.onPlayerError(e.detail)}onPlayerError(e){console.error("Error code",e.code,"object",e)}get currentTime(){return this.video.currentTime}get displayTime(){return this.controls.getDisplayTime()}getCurrentChapter(){return this.timeToChapter(this.currentTime)}timeToChapter(e){return this.chapters.timeToChapter(e)}play(){this.video.play()}pause(){this.video.pause()}seekTo(e){null!=e&&("number"==typeof e?this.video.currentTime=e:"number"==typeof e.timecode&&(this.video.currentTime=e.timecode))}skipSeconds(e){this.video.currentTime+=e}prevChapter(){this.seekTo(this.timeToChapter(this.currentTime-this.constants.prevChapterTolerance)??0)}nextChapter(){let e=this.getCurrentChapter();e&&this.seekTo(this.chapters.advance(e,1))}}document.addEventListener("shaka-ui-load-failed",(e=>{console.error("Unable to load the UI library!")}));var T=n(8),x=n.n(T);class S{constructor(e){this._jpeg=e,this._exif={"0th":{},Exif:{}}}static fromBinaryString(e){return new S(e)}toBinaryString(){const e=x().dump(this._exif);return x().insert(e,this._jpeg)}addMetadata(e){e.title&&(this._exif["0th"][x().ImageIFD.ImageDescription]=e.title),e.comment&&(this._exif.Exif[x().ExifIFD.UserComment]=e.comment)}}const C=String.fromCharCode(137,80,78,71,13,10,26,10);class P{constructor(e,t){this._headerChunk=e,this._chunks=t}static createChunk(e){const t={};switch(e.type){case"raw":t.type=e.rawType,t.data=e.rawData;break;case"iTXt":t.type="iTXt",t.data=`${e.keyword.replace(/\0/g,"")}\0\0\0\0\0${e.text}`;break;case"IEND":t.type="IEND",t.data=""}return t.size=t.data.length,t.crc=function(e){for(var t=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],n=-1,s=0;s<e.length;s++)n=n>>>8^t[255&(n^e.charCodeAt(s))];return(-1^n)>>>0}(t.type+t.data),t}addChunk(e){const t=P.createChunk(e);if("iTXt"!==t.type)throw new Error(`Adding chunk type ${t.type} is not supported.`);this._chunks.unshift(t)}static fromBinaryString(e){if(!function(e){return e.substr(0,8)==C}(e.substr(0,8)))return;let t;e=e.substr(8);for(var n=[];""!=e;){var s={},i=L(e.substr(0,4));i<0&&(i=0);var a=e.substr(0,i+12);e=e.substr(i+12),s.size=i,s.type=a.substr(4,4),s.data=a.substr(8,i),s.crc=L(a.substr(8+i,4)),"IHDR"===s.type?t=s:"IEND"!==s.type&&n.push(s)}return new P(t,n)}toBinaryString(){var e=C;const t=t=>{var n="";n+=E(t.size,4),n+=t.type,n+=t.data,n+=E(t.crc,4),e+=n};for(var n in t(this._headerChunk),this._chunks)t(this._chunks[n]);return t(P.createChunk({type:"IEND"})),e}addMetadata(e){for(const t of Object.keys(e)){const n=e[t];if(!n)continue;const s={title:"Title",comment:"Comment"}[t];s&&this.addChunk({type:"iTXt",keyword:s,text:n})}}}function E(e,t){for(var n=[],s=t-1;s>=0;){var i=255&e;n[s--]=i,e>>=8}return n=n.map((function(e){return String.fromCharCode(e)})),n.join("")}function L(e){for(var t=0,n=0;n<e.length;n++)t=t<<8|255&e.charCodeAt(n);return t}const M=[{mimeType:"image/png",label:"PNG",parseBinaryString:e=>P.fromBinaryString(e)},{mimeType:"image/jpeg",label:"JPEG",parseBinaryString:e=>S.fromBinaryString(e)},{mimeType:"image/tiff",label:"TIFF",parseBinaryString:()=>{}}];class I extends l{constructor(e,t,n){const s=M.filter((e=>t.supportsCanvasExport(e.mimeType)));super(e,{env:t,metadata:null,showMetadata:!0,timecode:null,supportedImageFormats:s,selectedImageFormat:s[0]}),this._videoDomElement=n.video}_createDom(){const e=this._state.env,t=super._createDom("screenshot-modal");t.title.innerText="Screenshot";const n=e.mkid();t.config=c(`\n      <div class="screenshot-config">\n        <input type="checkbox" id="${n}" class="show-metadata">\x3c!--\n        --\x3e<label for="${n}"> Metadaten einblenden</label>\n\n        Â·\n\n        Dateiformat:\n        <span class="image-formats"></span>\n\n        Â·\n\n        <a href="#" class="download-image">Bild herunterladen</a>\n      </div>\n    `),t.showMetadata=t.config.querySelector(".show-metadata"),t.showMetadata.checked=this._state.showMetadata,t.showMetadata.addEventListener("change",this.handleChangeShowMetadata.bind(this)),t.imageFormatSpan=t.config.querySelector(".image-formats");const s=e.mkid();for(const n of this._state.supportedImageFormats){const i=e.mkid(),a=document.createElement("input");a.id=i,a.name=s,a.type="radio",a.checked=n.mimeType===this._state.selectedImageFormat.mimeType,a.addEventListener("change",(()=>{this.setState({selectedImageFormat:n})}));const o=document.createElement("label");o.htmlFor=i,o.innerText=` ${n.label}`,t.imageFormatSpan.append(a,o)}return t.downloadImage=t.config.querySelector(".download-image"),t.downloadImage.addEventListener("click",this.handleDownloadImage.bind(this)),t.body.append(t.config),t.canvas=document.createElement("canvas"),t.body.append(t.canvas),t}setMetadata(e){return this.setState({metadata:e}),this}setTimecode(e){return this.setState({timecode:e}),this}handleChangeShowMetadata(e){this.setState({showMetadata:e.target.checked})}async handleDownloadImage(e){e.preventDefault();const t=this._state.selectedImageFormat,n=this._state.metadata.metadata.title,s=await(i=this._dom.canvas,a=t.mimeType,new Promise((e=>{i.toBlob(e,a,undefined)})));var i,a;const o=await(c=s,new Promise(((e,t)=>{const n=new FileReader;n.onload=t=>{e(t.target.result)},n.onerror=e=>{t(e.target.error)},n.readAsBinaryString(c)})));var c;const d=t.parseBinaryString(o);let l=s;if(d){const e=new URL(window.location);e.searchParams.set("timecode",this._state.timecode),d.addMetadata({title:n,comment:`Screenshot taken on Sachsen.Digital.\n\n${e.toString()}`});const t=function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(d.toBinaryString());l=new Blob([t],{type:s.type})}!function(e,t){const n=URL.createObjectURL(e);try{t(n)}catch(e){throw e}finally{URL.revokeObjectURL(n)}}(l,(e=>{const t=document.createElement("a");t.href=e,t.download=function(e){const t=e.replace(/[^a-zA-Z0-9()]+/g,"_");return t.length>0?t:"_"}(`Screenshot-${n}-T${r(this._state.timecode,!0)}`),t.click()}))}render(e){super.render(e);const{show:t,metadata:n,showMetadata:s}=e;var i;!t||this._state.show&&s===this._state.showMetadata||function(e,t,n){const[s,i]=e instanceof HTMLCanvasElement?[e,e.getContext("2d")]:[e.canvas,e];s.width=t.videoWidth,s.height=t.videoHeight,i.drawImage(t,0,0,s.width,s.height);const a=s.height/1080,o=10*a;i.font=`${Math.floor(25*a)}px Arial`,i.fillStyle="#FFFFFF",i.shadowBlur=5,i.shadowColor="black";for(const e of n.captions){const t="left"===e.h?o:s.width-o,n="top"===e.v?o:s.height-o;i.textAlign=e.h,i.fillText(e.text,t,n)}}(this._dom.canvas,this._videoDomElement,{captions:s?[{v:"bottom",h:"left",text:"https://sachsen.digital"},{v:"bottom",h:"right",text:(i=n,i.screenshotFields.map((e=>i.metadata[e])).filter((e=>"string"==typeof e)).join(" / "))}]:[]})}}const B=JSON.parse('[{"key":"Escape","action":"cancel","propagate":true,"kind":"other","order":100},{"key":"F1","action":"modal.help.toggle","kind":"other","order":99},{"key":"b","scope":"player","action":"modal.bookmark.open","kind":"other","order":30},{"key":"s","scope":"player","action":"modal.screenshot.open","kind":"other","order":31},{"key":"f","repeat":false,"scope":"player","action":"fullscreen.toggle","kind":"other","order":20},{"key":" ","repeat":false,"scope":"player","action":"playback.toggle","kind":"other","order":0},{"key":"m","repeat":false,"scope":"player","action":"playback.volume.mute.toggle","kind":"other","order":12},{"key":"ArrowUp","scope":"player","action":"playback.volume.inc","kind":"other","order":10},{"key":"ArrowDown","scope":"player","action":"playback.volume.dec","kind":"other","order":11},{"key":"ArrowLeft","scope":"player","action":"navigate.rewind","kind":"navigate","order":0},{"key":"ArrowRight","scope":"player","action":"navigate.seek","kind":"navigate","order":1},{"mod":"CtrlMeta","key":"ArrowLeft","scope":"player","action":"navigate.chapter.prev","kind":"navigate","order":10},{"mod":"CtrlMeta","key":"ArrowRight","scope":"player","action":"navigate.chapter.next","kind":"navigate","order":11},{"mod":"Shift","key":"ArrowLeft","scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"mod":"Shift","key":"ArrowRight","scope":"player","action":"navigate.frame.next","kind":"navigate","order":21},{"key":",","scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"key":".","scope":"player","action":"navigate.frame.next","kind":"navigate","order":21}]');window.SxndPlayerApp=class{constructor(e,t,n){this.container=e,this.videoInfo=t,this.lang=n,this.constants={prevChapterTolerance:5,volumeStep:.05,seekStep:10};const s=this.videoInfo.metadata.metadata;for(const e of Object.keys(s))Array.isArray(s[e])&&(s[e].length>0?s[e]=s[e][0]:delete s[e]);this.env=new d,this.env.setLang(n),this.actions={cancel:()=>{this.hideThumbnailPreview(),this.modals.closeNext()},"modal.help.open":()=>{this.hideThumbnailPreview(),this.modals.help.open()},"modal.help.toggle":()=>{this.hideThumbnailPreview(),this.modals.help.toggle()},"modal.bookmark.open":()=>{this.showBookmarkUrl()},"modal.screenshot.open":()=>{this.showScreenshot()},"fullscreen.toggle":()=>{this.hideThumbnailPreview(),this.sxndPlayer.controls.toggleFullScreen()},"playback.toggle":()=>{this.sxndPlayer.video.paused?this.sxndPlayer.video.play():this.sxndPlayer.video.pause()},"playback.volume.mute.toggle":()=>{this.sxndPlayer.video.muted=!this.sxndPlayer.video.muted},"playback.volume.inc":()=>{this.sxndPlayer.video.volume=Math.min(1,this.sxndPlayer.video.volume+this.constants.volumeStep)},"playback.volume.dec":()=>{this.sxndPlayer.video.volume=Math.max(0,this.sxndPlayer.video.volume-this.constants.volumeStep)},"navigate.rewind":()=>{this.sxndPlayer.skipSeconds(-this.constants.seekStep)},"navigate.seek":()=>{this.sxndPlayer.skipSeconds(+this.constants.seekStep)},"navigate.chapter.prev":()=>{this.sxndPlayer.prevChapter()},"navigate.chapter.next":()=>{this.sxndPlayer.nextChapter()},"navigate.frame.prev":()=>{this.sxndPlayer.vifa.seekBackward(1)},"navigate.frame.next":()=>{this.sxndPlayer.vifa.seekForward(1)}},this.keybindings=B,document.addEventListener("shaka-ui-loaded",this.onShakaUiLoaded.bind(this)),window.addEventListener("keyup",(e=>{e.stopImmediatePropagation()}),{capture:!0})}onShakaUiLoaded(){const e=document.createElement("video");e.id="video",e.poster=this.videoInfo.url.poster,e.style.width="100%",e.style.height="100%",this.container.append(e);const t=new p(this.videoInfo.chapters);let n=new URL(window.location).searchParams.get("timecode");null===n&&void 0!==this.videoInfo.pageNo&&(n=t.at(this.videoInfo.pageNo-1).timecode);const s=new _({env:this.env,container:this.container,video:document.getElementById("video"),manifestUri:this.videoInfo.url.manifest,timecode:n?parseFloat(n):void 0,chapters:t,controlPanelButtons:[g.register(this.env,{material_icon:"photo_camera",title:"Screenshot",onClick:this.actions["modal.screenshot.open"]}),g.register(this.env,{material_icon:"bookmark_border",title:"Bookmark",onClick:this.actions["modal.bookmark.open"]}),g.register(this.env,{material_icon:"help_outline",title:this.env.t("control.help.tooltip"),onClick:this.actions["modal.help.open"]})],constants:this.constants});s.initialize(),s.setLocale(this.lang.locale),i()("a[data-timecode]").on("click",(function(){const e=i()(this).data("timecode");s.play(),s.seekTo(e)})),this.modals=function(e){const t=Object.assign({},e),n=Object.values(e),s=document.createElement("div");s.className="sxnd-modal-cover",s.addEventListener("click",(()=>{t.closeAll()})),document.body.append(s);for(const e of n)e.on("updated",(()=>{t.hasOpen()?s.classList.add("shown"):s.classList.remove("shown")}));return t.hasOpen=()=>n.some((e=>e.isOpen)),t.closeNext=()=>{for(const e of n)if(e.isOpen){e.close();break}},t.closeAll=()=>{for(const e of n)e.close()},t}({help:new y(this.container,this.env,{constants:this.constants,keybindings:this.keybindings}),bookmark:new h(this.container,this.env),screenshot:new I(this.container,this.env,{video:s.video})}),this.sxndPlayer=s,document.addEventListener("keydown",this.onKeyDown.bind(this),{capture:!0})}hideThumbnailPreview(){this.sxndPlayer.thumbnailPreview.hidePreview()}getKeyboardScope(){return this.modals.hasOpen()?"modal":"player"}onKeyDown(e){let t=!0;const n=function(e){let t=k.None;return(e.ctrlKey||e.metaKey)&&(t|=k.CtrlMeta),e.shiftKey&&(t|=k.Shift),e.altKey&&(t|=k.Alt),t}(e),s=this.getKeyboardScope(),i=this.keybindings.find((t=>!("function"!=typeof this.actions[t.action]||t.key!==e.key||null!=t.repeat&&t.repeat!==e.repeat||null!=t.scope&&t.scope!==s||k[t.mod??"None"]!==n)));i&&(e.preventDefault(),this.actions[i.action](),!0===i.propagate&&(t=!1)),t&&e.stopImmediatePropagation()}showBookmarkUrl(){this.sxndPlayer.pause(),this.hideThumbnailPreview(),this.modals.bookmark.setTimecode(this.sxndPlayer.displayTime).open()}showScreenshot(){this.sxndPlayer.pause(),this.hideThumbnailPreview(),this.modals.screenshot.setMetadata(this.videoInfo.metadata).setTimecode(this.sxndPlayer.displayTime).open()}}}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,s),a.exports}s.m=t,e=[],s.O=(t,n,i,a)=>{if(!n){var o=1/0;for(l=0;l<e.length;l++){for(var[n,i,a]=e[l],r=!0,c=0;c<n.length;c++)(!1&a||o>=a)&&Object.keys(s.O).every((e=>s.O[e](n[c])))?n.splice(c--,1):(r=!1,a<o&&(o=a));if(r){e.splice(l--,1);var d=i();void 0!==d&&(t=d)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,i,a]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={825:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[o,r,c]=n,d=0;if(o.some((t=>0!==e[t]))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(c)var l=c(s)}for(t&&t(n);d<o.length;d++)a=o[d],s.o(e,a)&&e[a]&&e[a][0](),e[o[d]]=0;return s.O(l)},n=self.webpackChunkslub_web_sachsendigital=self.webpackChunkslub_web_sachsendigital||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=s.O(void 0,[276],(()=>s(630)));i=s.O(i)})();
//# sourceMappingURL=SxndPlayerApp.js.map